{% extends 'base.html' %}

{% block content %}
<div class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h1 class="h4 fw-bold text-dark mb-0">{{ _('Events') }}</h1>
            <p class="text-muted small mb-0">{{ _('Manage upcoming meetings') }}</p>
        </div>
        {% if current_user.is_authenticated and current_user.role in ['super-admin', 'editor'] %}
            <a href="{{ url_for('events.create_event') }}" class="btn btn-primary d-flex align-items-center gap-1">
                <i class="fas fa-plus small"></i>
                <span class="d-none d-md-inline">{{ _('New Event') }}</span>
            </a>
        {% endif %}
    </div>

    <div class="event-grid">
        {% for item in events_stats %}
            {% set event = item.event %}
            {% if event.status != 'hidden' or (current_user.is_authenticated and (current_user.role == 'super-admin' or (current_user.role == 'editor' and event.created_by == current_user.id))) %}
                <div class="compact-event-card position-relative" onclick="if(!event.target.closest('a') && !event.target.closest('button') && !event.target.closest('.stat-pill-link')) window.location='{{ url_for('events.event', event_id=event.id) }}'" style="cursor: pointer;">
                    <div class="card-image-wrapper">
                        {% if event.photo_filename %}
                            <img src="{{ url_for('events.uploaded_file', filename=event.photo_filename) }}" alt="{{ event.title }}">
                        {% elif event.photo_url %}
                            <img src="{{ event.photo_url }}" alt="{{ event.title }}">
                        {% else %}
                            <div class="h-100 d-flex align-items-center justify-content-center bg-light text-muted opacity-25">
                                <i class="fas fa-calendar fa-2x"></i>
                            </div>
                        {% endif %}
                        
                        <span class="event-status-badge status-{{ event.status }}">
                            {{ _(event.status|capitalize) }}
                        </span>
                    </div>

                    <div class="card-content">
                        <div class="card-meta">
                            <span><i class="far fa-calendar-alt"></i> {{ event.date.strftime('%d %b %Y') }}</span>
                            {% if event.start_time %}
                                <span><i class="far fa-clock"></i> {{ event.start_time.strftime('%H:%M') }}</span>
                            {% endif %}
                        </div>
                        
                        <h6 class="card-title-compact" title="{{ event.title }}">{{ event.title }}</h6>
                        
                        <div class="card-description-compact">
                            {{ event.description|strip_html }}
                        </div>

                        <div class="card-footer-compact">
                            <a href="{{ url_for('events.event', event_id=event.id) }}" class="btn btn-sm btn-outline-primary py-1">
                                {{ _('Details') }}
                            </a>

                            {% if current_user.is_authenticated and (current_user.role == 'super-admin' or (current_user.role == 'editor' and event.created_by == current_user.id)) %}
                                <div class="d-flex align-items-center gap-1">
                                    <div class="d-flex gap-1 me-1">
                                        <a href="{{ url_for('events.mark_attendance', event_id=event.id) }}" class="stat-pill stat-pill-link text-decoration-none" title="{{ _('Attendance Management') }}">
                                            <i class="fas fa-users"></i> {{ item.total_registered }}
                                        </a>
                                    </div>
                                    <a href="{{ url_for('events.edit_event', event_id=event.id) }}" class="btn-icon" title="{{ _('Edit') }}">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}

