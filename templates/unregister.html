{% extends 'base.html' %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-xl-4 col-lg-6">
            <div class="detail-section">
                <div class="section-title-compact">{{ _('Unregister from Event') }}</div>
                <h5 class="fw-bold mb-3">{{ event.title }}</h5>
                
                <form method="POST" action="{{ url_for('events.unregister', event_id=event.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-3">
                        <label for="email" class="form-label-compact">{{ _('Email Address') }}</label>
                        <input type="email" id="email" name="email" class="form-control-compact" required placeholder="john@example.com">
                    </div>
                    <div class="mb-3" id="unique_key_container">
                        <label for="unique_key" class="form-label-compact">{{ _('Unique Key') }}</label>
                        <input type="text" id="unique_key" name="unique_key" class="form-control-compact" required placeholder="Enter your key">
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="forgot_key" name="forgot_key">
                        <label class="form-check-label small" for="forgot_key">
                            {{ _('I forgot my unique key') }}
                        </label>
                    </div>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" id="submit_btn" class="btn btn-danger py-2">
                            <i class="fas fa-user-minus me-2"></i> {{ _('Cancel My Registration') }}
                        </button>
                        <a href="{{ url_for('events.event', event_id=event.id) }}" class="btn btn-outline-primary py-2">
                            {{ _('Back to Event') }}
                        </a>
                    </div>
                </form>

                <script>
                    document.getElementById('forgot_key').addEventListener('change', function() {
                        const uniqueKeyInput = document.getElementById('unique_key');
                        const uniqueKeyContainer = document.getElementById('unique_key_container');
                        const submitBtn = document.getElementById('submit_btn');
                        
                        if (this.checked) {
                            uniqueKeyContainer.style.display = 'none';
                            uniqueKeyInput.required = false;
                            submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i> {{ _("Send Me My Key") }}';
                            submitBtn.className = 'btn btn-primary py-2';
                        } else {
                            uniqueKeyContainer.style.display = 'block';
                            uniqueKeyInput.required = true;
                            submitBtn.innerHTML = '<i class="fas fa-user-minus me-2"></i> {{ _("Cancel My Registration") }}';
                            submitBtn.className = 'btn btn-danger py-2';
                        }
                    });
                </script>
            </div>
            
            <p class="text-center mt-3 text-muted x-small">
                <i class="fas fa-info-circle me-1"></i> {{ _('Note: This action cannot be undone.') }}
            </p>
        </div>
    </div>
</div>
{% endblock %}