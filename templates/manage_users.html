{% extends 'base.html' %}

{% block content %}
<header class="header-compact">
    <div class="container-fluid">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h1>{{ _('User Management') }}</h1>
                <div class="header-meta">
                    <span><i class="fas fa-user-shield"></i> {{ _('Administrators & Editors') }}</span>
                    <span><i class="fas fa-users"></i> {{ users|length }} {{ _('Total Users') }}</span>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="container-fluid mt-4">
    <div class="row g-4">
        <!-- Section: Add Editor -->
        <div class="col-lg-4">
            <div class="detail-section">
                <h2 class="section-title-compact">
                    <i class="fas fa-plus-circle"></i> {{ _('Add a new editor') }}
                </h2>
                <form method="POST" action="{{ url_for('auth.create_editor') }}" class="mt-3">
                    <div class="mb-3">
                        <label for="username" class="form-label-compact">{{ _('Username') }}</label>
                        <input type="text" id="username" name="username" class="form-control-compact" placeholder="johndoe" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label-compact">{{ _('Email') }}</label>
                        <input type="email" id="email" name="email" class="form-control-compact" placeholder="john@example.com" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2 mt-2">
                        <i class="fas fa-user-plus me-2"></i> {{ _('Create editor account') }}
                    </button>
                    <p class="text-muted mt-3 x-small">
                        <i class="fas fa-info-circle me-1"></i> {{ _('New editors will be able to manage meetings and content.') }}
                    </p>
                </form>
            </div>
        </div>

        <!-- Section: Existing Users -->
        <div class="col-lg-8">
            <div class="detail-section p-0 overflow-hidden">
                <div class="px-3 pt-3">
                    <h2 class="section-title-compact mb-0">
                        <i class="fas fa-list"></i> {{ _('Existing Users') }}
                    </h2>
                </div>
                
                <div class="table-responsive mt-2">
                    <table class="table-compact" data-confirm-message="{{ _('Are you sure you want to delete this user?') }}">
                        <thead>
                            <tr>
                                <th>{{ _('User') }}</th>
                                <th>{{ _('Access Level') }}</th>
                                <th>{{ _('Update Access') }}</th>
                                <th class="text-end">{{ _('Actions') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="user-avatar">
                                                {{ user.username[:2]|upper }}
                                            </div>
                                            <div class="d-flex flex-column">
                                                <span class="fw-bold text-slate-900">{{ user.username }}</span>
                                                <span class="text-slate-400 x-small truncate">{{ user.email }}</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-role-{{ user.role|lower }}">
                                            {% if user.role == 'super-admin' %}
                                                <i class="fas fa-crown me-1"></i> Super Admin
                                            {% else %}
                                                <i class="fas fa-pen-nib me-1"></i> Editor
											{% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <form method="POST" action="{{ url_for('auth.manage_users') }}" class="d-flex gap-2 align-items-center">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <select name="role" class="form-control-compact py-1" style="width: auto; min-width: 120px;">
                                                <option value="editor" {% if user.role == 'editor' %}selected{% endif %}>{{ _('Editor') }}</option>
                                                <option value="super-admin" {% if user.role == 'super-admin' %}selected{% endif %}>Super-Admin</option>
                                            </select>
                                            <button type="submit" class="btn btn-outline-primary p-1 px-2" title="{{ _('Update Role') }}">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                    </td>
                                    <td class="text-end">
                                        {% if current_user.role == 'super-admin' %}
                                            <div class="action-group justify-content-end">
                                                <form method="POST" action="{{ url_for('auth.reset_password', user_id=user.id) }}" class="d-inline">
                                                    <button type="submit" class="btn btn-outline-primary" title="{{ _('Reset Password') }}">
                                                        <i class="fas fa-key"></i>
                                                    </button>
                                                </form>
                                                
                                                {% if user.id != current_user.id %}
                                                <form method="POST" action="{{ url_for('auth.delete_user', user_id=user.id) }}" class="d-inline">
                                                    <button type="button" class="btn btn-outline-danger delete-user-btn" data-user-id="{{ user.id }}" title="{{ _('Delete User') }}">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>
                                                </form>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .x-small { font-size: 0.65rem; }
    .text-slate-900 { color: var(--slate-950); }
    .text-slate-400 { color: var(--slate-400); }
</style>

<script src="{{ url_for('static', filename='manage_users.js') }}"></script>
{% endblock %}

